
> json-hub@0.1.0 test
> jest lib/parsers/flattener.test.ts

FAIL lib/parsers/flattener.test.ts
  flattener
    flattenJSON
      ΓêÜ should flatten a simple flat object (6 ms)
      ΓêÜ should flatten nested objects with dot notation (1 ms)
      ΓêÜ should handle arrays of objects (1 ms)
      ΓêÜ should serialize arrays of primitives as JSON strings (1 ms)
      ├ù should handle arrays of nested objects (11 ms)
      ΓêÜ should fill missing columns with null (1 ms)
      ΓêÜ should handle deeply nested objects
      ΓêÜ should handle mixed data types (1 ms)
      ΓêÜ should handle empty array (1 ms)
      ΓêÜ should handle null input (1 ms)
      ΓêÜ should handle undefined input
      ΓêÜ should handle circular references (1 ms)
      ΓêÜ should handle large datasets efficiently (4 ms)
      ΓêÜ should handle objects with special characters in keys
      ├ù should handle GeoJSON coordinates intelligently (3 ms)
      ├ù should serialize nested arrays (2 ms)
      ├ù should expand arrays of objects but serialize their primitive arrays (1 ms)
    inferSchema
      ΓêÜ should infer schema from array of objects
      ΓêÜ should limit sampling to specified size (3 ms)
      ΓêÜ should handle nested objects in schema inference (1 ms)
    unflattenObject
      ΓêÜ should unflatten a simple flat object
      ΓêÜ should unflatten nested objects (1 ms)
      ΓêÜ should unflatten arrays
      ├ù should roundtrip flatten and unflatten (2 ms)

  ΓùÅ flattener ΓÇ║ flattenJSON ΓÇ║ should handle arrays of nested objects

    expect(received).toEqual(expected) // deep equality

    - Expected  -  4
    + Received  + 10

      Object {
    -   "users.0.age": 30,
    -   "users.0.name": "John",
    -   "users.1.age": 25,
    -   "users.1.name": "Jane",
    +   "users": Array [
    +     Object {
    +       "age": 30,
    +       "name": "John",
    +     },
    +     Object {
    +       "age": 25,
    +       "name": "Jane",
    +     },
    +   ],
      }

      71 |
      72 |             expect(result.rows).toHaveLength(1);
    > 73 |             expect(result.rows[0]).toEqual({
         |                                    ^
      74 |                 'users.0.name': 'John',
      75 |                 'users.0.age': 30,
      76 |                 'users.1.name': 'Jane',

      at Object.toEqual (lib/parsers/flattener.test.ts:73:36)

  ΓùÅ flattener ΓÇ║ flattenJSON ΓÇ║ should handle GeoJSON coordinates intelligently

    expect(received).toContain(expected) // indexOf

    Matcher error: received value must not be null nor undefined

    Received has value: undefined

      231 |
      232 |             // Coordinates should be serialized as JSON string
    > 233 |             expect(result.rows[0]['features.0.geometry.coordinates']).toContain('[');
          |                                                                       ^
      234 |             expect(typeof result.rows[0]['features.0.geometry.coordinates']).toBe('string');
      235 |
      236 |             // Regular properties should still be flattened

      at Object.toContain (lib/parsers/flattener.test.ts:233:71)

  ΓùÅ flattener ΓÇ║ flattenJSON ΓÇ║ should serialize nested arrays

    expect(received).toBe(expected) // Object.is equality

    Expected: "[[1,2,3],[4,5,6]]"
    Received: [[1, 2, 3], [4, 5, 6]]

      249 |
      250 |             expect(result.rows).toHaveLength(1);
    > 251 |             expect(result.rows[0].matrix).toBe('[[1,2,3],[4,5,6]]');
          |                                           ^
      252 |         });
      253 |
      254 |         it('should expand arrays of objects but serialize their primitive arrays', () => {

      at Object.toBe (lib/parsers/flattener.test.ts:251:43)

  ΓùÅ flattener ΓÇ║ flattenJSON ΓÇ║ should expand arrays of objects but serialize their primitive arrays

    expect(received).toBe(expected) // Object.is equality

    Expected: "John"
    Received: undefined

      263 |             expect(result.rows).toHaveLength(1);
      264 |             // Users array should be expanded
    > 265 |             expect(result.rows[0]['users.0.name']).toBe('John');
          |                                                    ^
      266 |             expect(result.rows[0]['users.1.name']).toBe('Jane');
      267 |             // But tags (primitive arrays) should be serialized
      268 |             expect(result.rows[0]['users.0.tags']).toBe('"admin", "user"');

      at Object.toBe (lib/parsers/flattener.test.ts:265:52)

  ΓùÅ flattener ΓÇ║ unflattenObject ΓÇ║ should roundtrip flatten and unflatten

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 1

    @@ -1,10 +1,7 @@
      Object {
    -   "items": Array [
    -     "apple",
    -     "banana",
    -   ],
    +   "items": "\"apple\", \"banana\"",
        "user": Object {
          "address": Object {
            "city": "NYC",
            "zip": "10001",
          },

      366 |             const unflattened = unflattenObject(flattened.rows[0]);
      367 |
    > 368 |             expect(unflattened).toEqual(original);
          |                                 ^
      369 |         });
      370 |     });
      371 | });

      at Object.toEqual (lib/parsers/flattener.test.ts:368:33)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 19 passed, 24 total
Snapshots:   0 total
Time:        3.536 s
Ran all test suites matching /lib\\parsers\\flattener.test.ts/i.
